{% extends "base.html" %}
{% set currentPage = "done" %}
{% block title %} Review Your Application {% endblock %}

{% block body %}

<h1>Review Your Application</h1>

<p>
   How does it look, {{ldap.firstname}}?
</p>

<div class = "col-sm-8 col-sm-offset-2">
   <dl class="dl-horizontal">
     <dt>Project Info</dt>
       <dd>Title: {{proj.title}}</dd>
       <dd>Start Date: {{proj.startDate}}</dd>
       <dd>Duration: {{proj.duration}} weeks</dd>
       <dd>Number of Students: {{proj.numberStudents}}</dd>
       <dd>Community Partners:
         {% if proj.hasCommunityPartner %}
           Yes 
         {% else %} 
           No 
         {% endif %}
       </dd>
       <dd>Community Service: 
         {% if proj.isServiceToCommunity %}
           Yes 
         {% else %} 
           No 
         {% endif %}
       </dd>
       <dd>Date Submitted: {{proj.createdDate}}</dd>
     <br />
     {% if collabs is not none %}
     <dt>Collaborators</dt>
       {% for collaborator in collabs %}
         <dd>{{collaborator.firstname}} {{collaborator.lastname}}</dd>
       {% endfor %}
       <br />
     {% endif %}
     
     <dt>Budget</dt>
     <dd>Faculty Stipend: ${{budg.facultyStipend}}</dd>
         <dd><strong>Description:</strong> {{budg.facultyStipendDesc}}</dd>
     <dd>Equipment: ${{budg.equipment}}</dd>
       <dd><strong>Description: </strong>{{budg.equipmentDesc}}</dd>
     <dd>Materials: ${{budg.materials}}</dd>
       <dd><strong>Description: </strong>{{budg.materialsDesc}}</dd>
     <dd>Travel: ${{budg.otherTravel}}</dd>
       <dd><strong>Description: </strong>{{budg.otherTravelDesc}}</dd>
       {% set mileageCost = '%.2f' | format(budg.miles*params.mileageRate) %}
     <dd>Mileage: {{budg.miles}} miles (${{ mileageCost }} @ {{params.mileageRate}} / mile)</dd>
       <dd><strong>Description: </strong>{{budg.milesDesc}}</dd>
     <dd>Other: ${{budg.other}}</dd>
       <dd><strong>Description: </strong>{{budg.otherDesc}}</dd>
     <br />
     {% set totalBudget = '%.2f' | format(budg.facultyStipend + budg.equipment + budg.materials + budg.otherTravel + budg.miles*params.mileageRate + budg.other) %}
     <dd><strong>Total Budget:</strong> ${{totalBudget}}</dd>
     <br />
     <dt>Files</dt>
       {% for item in uploadedFiles %}
       <dd><a href = "/static/files/{{cfg['urcpp']['applicationCycle']}}/{{username}}/{{item}}" target = "_blank">{{item}}</a></dd>
       {% endfor %}
   </dl>
      
  <div class = "form-group"  >
    <div class = "col-sm-offset-9 col-sm-2" 
         id = "submitButton"
         >
      <button id = "submit" 
              type = "button" 
              class="btn btn-primary"
              onClick = "finalizeSubmission();"
              class = "form-control"
              />
        Submit Your Application
      </button>
    </div>
  </div>
</div>


<script>
  /* global api, swal, urcpp */
  api = urcpp("v1");
  
  function handleResponse (data) {
    if (data.response == "OK") {
      window.location.href = window.location.href = api.next();
    } else {
     
      swal({  title: "Please contact " + urcpp.constants.alertEmail,   
              text: data["details"],   
              type: "error",   
              confirmButtonText: "Uh-Oh." 
      });
    }
  };
  
  function finalizeSubmission() {
    console.log("Finalizing application");
    api.set.finalize(username, handleResponse); 
    api.go();
  };
</script>

{% endblock %}
