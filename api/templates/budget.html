{% extends "base.html" %}

{% block body %}

<h1> Budget </h1>
<p>
URCPP can provide stipends for you and your students, plus up to $3000 for equipment, supplies, and related travel.
</p>

<!-- This is the only actual HTML on the page.
     The rest of it is JavaScript. -->
<div class = "row">
  <form id = "budgetForm"
        class = "form-horizontal col-sm-10 col-sm-offset-1">
    
    
    <!-- Loop starts here for each box -->
    {% for budget in cfg["budget"] %}
    <div  class = 'form-group' 
          id = "inputGroup{{loop.index0}}" >
      <div  class = "row" 
            style = "padding-bottom: 10px; padding-top: 30px;">
          <label  for='{{budget["title"]}}{{loop.index0}}' 
                  class = 'col-sm-4 control-label'>
            {{budget["title"]}}
          </label>
      
          <div class = 'col-sm-8'>
            <input  name  = 'quantity' 
                    id    = '{{budget["title"]}}{{loop.index0}}' 
                    type  = 'text' 
                    class = 'form-control'
                    value = '{{budg[budget["amountFieldName"]]}}'
                    onchange = "findTotal()" 
                    placeholder = {% if budget.title != "Miles " %}'($)' {% else %} "# Miles" {% endif %}
                    />
          </div>
      </div>    
      <div class = "row">
        <label for='{{budget["title"]}}{{loop.index0}}' class = 'col-sm-4 control-label'>
          {{budget.title}} Description
        </label>
        <div class = "col-sm-8">
          <textarea class="form-control" 
                    style="min-width: 100%"
                    rows = "3"
                    placeholder = "{{budget['placeholder']}}"
                    id = '{{budget["title"]}}Description'>{{budg[budget["descFieldName"]]}}</textarea> 
        </div>
      </div>
    </div>
    {% endfor %}
    <!-- Loop ends here for each box -->
    
    <div class = 'form-group has-success' id = "totalGroup" >
      <div class = "row">
        <label for='total' class = 'col-sm-4 control-label'>
          Total ($)
        </label>
        <div class = 'col-sm-8'>
          <input  name  = 'total' 
                  id    = 'total' 
                  type  = 'text' 
                  class = 'form-control'
                  value = "0"
                  readonly
                  />
        </div>
      </div>
    </div>
  
    <div class = "form-group"  >
    <div class = "col-sm-offset-10 col-sm-2" 
         id = "submitButton"
         >
      <button id = "submit" 
              type = "button" 
              class="btn btn-block btn-primary"
              onClick = "submitData();"
              class = "form-control"
              />
        Submit
      </button>
    </div>
  </div>
</form>

<script type = "text/javascript">
  // This little bit of script totals things up as 
  // people enter their budget items.
  function findTotal() {
    var arr = document.getElementsByName("quantity");
    var tot = 0;
    
    for(var i = 0; i < arr.length; i++){
      var value = arr[i].value;
      // console.log("Element value: " + value)
      if(parseInt(value))
          tot += parseInt(value);
    }
    
  // Set the total.
  $("#total").val(tot);
  };
  
  // Need to run on first page load.
  $(document).ready ( function () {
    findTotal();
  });
</script>


<!-- Submit data to server -->
<script type = "text/javascript">
   /* global api, username, formToObj, show */
  api = urcpp("v1"); 
  
  function submitData() {
    var obj = formToObj(document.querySelector("form"));
    console.log(obj);
    // api.set.people (username, obj, show); 
    // api.go();
  };
</script>

{% endblock %}