{% extends "base.html" %}
{% block body %}

      
<script id = "collabInputT"  type = "x-tmpl-mustache">
  <div class = 'form-group'>
    <label for='{{id}}' class = 'col-sm-3 control-label'>
      Collaborator{{id}}
    </label>
    <div class = 'col-sm-8'>
      <input name = '{{id}}' id = '{{id}}' type = 'text' class='form-control'/>
    </div>
  </div>
</script>

<form class = "form-horizontal well">
  <div id = "moreCollaborators">
    <h4> Collaborators </h4>
    
    <div class = "form-group spinner">
      <label  for = "numberOfCollaborators"
              name = "numberOfCollaborators"
              class = "col-sm-3 control-label">
        Number of Collaborators
      </label>
      
      <div class = "col-sm-8">
        <input  id = "numCollab" 
                type = "text" 
                value = "" 
                name = "numCollab"
                style = "text-align: right;"
                > </input>
      </div>
    </div>
  
  
<!--  
    <div class = "form-group">
      <label for="c2" class = "col-sm-3 control-label">Collaborator 2 </label>
      <div class = "col-sm-8">
        <input name = "c2" id = "c2" type = "text" class="form-control"/>
      </div>
    </div>
    
    <h4> Students </h4>
    <div class = "col-sm-9">
      <input  name = "numberStudents"
              id = "numberStudents" 
              type = "number" 
              min = "1" 
              step ="1"
              />
    </div>
    -->
  </div>
</form>
<!--
<form>
  <div class = "row">
    <div class = "col-md-3">
      Professors
    </div>
    <div class = "col-md-3">
      Professor 1: <input name = "professor1" id = "professor1" type = "text" />
    </div>
    <div class = "col-md-3">
      Professor 2: <input name = "professor2" id = "professor2" type = "text" />
    </div >
    <div class = "col-md-3"> 
      Professor 3: <input name = "professor3" id = "professor3" type = "text" />
    </div>
    <div class = "col-md-3">
      Professor 4: <input name = "professor4" id = "professor4" type = "text"  />
    </div>
  </div>
</form>

<div class = "col-md-3">
  Number of students: <input name = "numberStudents"id = "numberStudents" type = "number" min = "1" step ="1" />
</div>
-->

<!-- JQuery Init -->
<script type = "text/javascript">
   /* global urcpp */
  var api = urcpp('v1');

</script>

<!-- Submit data to server -->
<script type = "text/javascript">
   /* global api, username, formToObj, show */
  var submitData = function () {
    var obj = formToObj(document.querySelector("form"));
    console.log(obj);
    api.set.start(username, obj, show); 
  };
</script>

<!-- Loading data from the server -->
<script type = "text/javascript">
  /* global api, username */
  
  var show = function (d) {
    console.log (d);
    $("#echo").text(JSON.stringify (d));
  };

  // This function sets the project title field
  var setNumberOfStudents = function (data) {
    // console.log(JSON.stringify(data));
    if ("project" in data) {
      $("#numberStudents").val(data.project.numberStudents);
      //$("#startDate").val(data.project.startDate);
    }
  };
  // This API call asks the server for the project title.
  api.projects.get(username, setNumberOfStudents);
  
  /*var setOptions = function (element, options) {
    var $el = $("#" + element);
    $el.empty(); // remove old options
    $.each(
      options, 
      function (value,key) {
        $el.append($("<option></option>")
           .attr("value", value).text(key));
      }
    );  
  }
  
  var setProgram = function (data) {
    var programs = data.programs;
    // console.log(JSON.stringify(programs));

    var options = {};
    for (var ndx = 0; ndx < programs.length ; ndx++ ) {
      var prog = programs[ndx];
      console.log("Name: " + prog.name + " ID: " + prog.pID);
      options[prog.pID] = prog.name;
    }
    
    setOptions ("program", options);
  };
  
  api.programs.getAll(setProgram);
  
  var setDuration = function (data) {
    var durations = data.durations;
    
    var options = {};
    for (var ndx = 0; ndx < durations.length ; ndx++ ) {
      var dur = durations[ndx];
      options[dur] = dur + " weeks";
    }
   
    setOptions("duration", options);
  };
  
  api.projects.getPossibleDurations(setDuration);
  
  var setDate = function (data) {
    // console.log(JSON.stringify(data));
    if ("startDate" in data) {
      $("#startDate").val(data.project.startDate);
    }
  }*/
  
  
  /* global Mustache */
  var collabSpin = $("#numCollab")
    .TouchSpin( {
      verticalbuttons: true,
      min: 1,
      step: 1,
      initval: 1
    });

  $(document).ready(function () {
    collabSpin.on("change", function () {
      var spin = $("#numCollab").val();
      var tmpl = $("#collabInputT").html();
      
      console.log("Spin: " + spin);
      console.log("Template:\n" + tmpl);
      
      var view = { "id" : "" + spin };
      var rendered = Mustache.to_html(tmpl, view);
      
      console.log(rendered);
      
      $("#moreCollaborators").append(rendered);
    });
  });


</script>

{% endblock %}