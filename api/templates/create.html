{#
  Variables needed for this page: 
    - proj (a complete Projects object)
    - ldap (a complete LDAPFaculty object)
    - fac (a complete URCPPFaculty object)
    - progs (a list of programs)
    - cfg
#}

{% extends "base.html" %}

{% block title %} URCPP Project Basics {% endblock %}

{% block body %}

<h1>URCPP Project Basics</h1>

<p>
  {{ldap.firstname}}, your project submission will require you to provide:
</p>

<ol>
  <li> Project Basics (this page) </li>
  <li> BNumbers for collaborators (if any) </li>
  <li> A project budget & number of students </li>
  <li> A project narrative (.docx or PDF) </li>
  <li> Something else? </li>
</ol>

<p>
  After you are finished, any project collaborators will need to login and submit their CVs as well. At that point, your submission will be complete.  
</p>

<form class = "form-horizontal">
  <div class = "form-group">
    <label for="title" class = "col-sm-2 control-label">Project Title </label>
    <div class = "col-sm-9">
      <input name = "title" id = "title" type = "text" class="form-control" value = "{{proj.title}}"></input>
    </div>
  </div>
  
  <div class = "form-group">
    <label for = "program" class = "col-sm-2 control-label">Program </label>
    <div class = "col-sm-9">
      <select name = "program" id = "program" class="form-control"> 
      {% for prog in progs | sort %}
        <option value = "{{prog.pID}}">{{prog.abbreviation}}: {{prog.name}}</option>
      {% endfor %}
      </select>
    </div>
  </div>
  
  <div class = "form-group"> 
    <label for = "duration" class = "col-sm-2 control-label">Duration </label>
    <div class = "col-sm-9">
      <select name = "duration" id = "duration" class="form-control"> 
      {% for dur in cfg["urcpp"]["possibleDurations"] | sort %}
        <option>{{dur}}</option>
      {% endfor %}
      </select>  
    </div>
  </div>
  
  <div class = "form-group">
    <label for = "startDate" class = "col-sm-2 control-label">Start Date </label>
    <div class = "col-sm-9">
      <input name = "startDate" id = "startDate" type = "text"  class="form-control" value = "{{proj.startDate}}"> </input>
    </div>
  </div>
  
  <script type = "text/javascript">
    $(function() {
      $( "#startDate" ).datepicker();
    });
  </script>
  
  <div class = "form-group"  >
    <div class = "col-sm-offset-9 col-sm-2" 
         id = "submitButton"
         >
      <button id = "submit" 
              type = "button" 
              class="btn btn-block btn-primary"
              onClick = "submitData();"
              class = "form-control"
              />
        Submit
      </button>
    </div>
  </div>
</form>

<!-- Load this page's JavaScript 
<script src = "/s/js/pages/create.js" type = "text/javascript"> </script>
-->
<script>
  api = urcpp("v1");
  
  
  function handleResponse (data) {
    if (data.response == "OK") {
      window.location.href = window.location.href = api.next();
    } else {
      /* global swal, urcpp */
      swal({  title: "Please contact " + urcpp.constants.alertEmail,   
              text: data["details"],   
              type: "error",   
              confirmButtonText: "Uh-Oh." 
      });
    }
  };
  function submitData () {
    var obj = formToObj(document.querySelector("form"));
    console.log("Sending data to server: " + JSON.stringify(obj) + "\n\n");
    api.set.create (username, obj, handleResponse ); 
    api.go();
  };
</script>

{% endblock %}